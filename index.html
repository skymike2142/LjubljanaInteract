<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ljubljana – Interactive History Map</title>
  <link rel="preconnect" href="https://{s}.tile.openstreetmap.org">
  <!-- Leaflet CSS -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />
  <style>
    html, body { height: 100%; margin: 0; }
    #map { position: absolute; inset: 0; }
    .leaflet-popup-content { max-width: 300px; }
    .topbar {
      position: fixed; left: 12px; top: 12px; z-index: 1000;
      background: rgba(255,255,255,0.9); backdrop-filter: blur(6px);
      border-radius: 12px; box-shadow: 0 6px 20px rgba(0,0,0,0.12);
      padding: 10px 12px; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }
    .topbar h1 { font-size: 16px; margin: 0 0 6px; }
    .searchbox { display: flex; gap: 8px; }
    .searchbox input {
      width: 240px; max-width: 50vw;
      padding: 8px 10px; border: 1px solid #ddd; border-radius: 10px;
    }
    .searchbox button {
      padding: 8px 12px; border: 1px solid #ddd; border-radius: 10px;
      background: #fff; cursor: pointer;
    }
    .attribution { position: fixed; right: 8px; bottom: 8px; z-index: 800; background: rgba(255,255,255,0.8); padding: 4px 8px; border-radius: 8px; font: 12px/1.3 system-ui; }
  </style>
</head>
<body>
  <div id="map" aria-label="Map of Ljubljana with historical locations"></div>

  <!-- Simple search and help -->
  <div class="topbar" role="region" aria-label="Map controls">
    <h1>Ljubljana – Interactive History Map</h1>
    <div class="searchbox">
      <input id="q" type="search" placeholder="Search locations… (e.g., Prešeren, 1848)" aria-label="Search locations" />
      <button id="btn-search" title="Search">Search</button>
      <button id="btn-reset" title="Reset">Reset</button>
    </div>
  </div>

  <div class="attribution">Map data © <a href="https://www.openstreetmap.org/" target="_blank" rel="noopener">OpenStreetMap</a> contributors</div>

  <!-- Leaflet JS -->
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""
  ></script>

  <script>
    // 1) Base map
    const map = L.map('map', {
      zoomControl: true,
      minZoom: 11,
      maxZoom: 19
    }).setView([46.0569, 14.5058], 14); // center on Ljubljana

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    // 2) Data: add/modify your locations here
    // Fields: id, title, year, lat, lng, description (HTML allowed), optional: image, link
    const PLACES = [
      {
        id: 'preseren-square',
        title: 'Prešernov trg – Prešeren Square',
        year: 1905,
        lat: 46.051426, lng: 14.506579,
        description: `Central square named after poet France Prešeren. A frequent site of public gatherings and events in modern Slovenian history.`,
        link: 'https://sl.wikipedia.org/wiki/Pre%C5%A1ernov_trg'
      },
      {
        id: 'triple-bridge',
        title: 'Tromostovje – Triple Bridge',
        year: 1932,
        lat: 46.051081, lng: 14.506194,
        description: `Plečnik’s redesign joined two pedestrian bridges to the central stone bridge, becoming a key symbol of Ljubljana.`,
        link: 'https://sl.wikipedia.org/wiki/Tromostovje'
      },
      {
        id: 'congress-square',
        title: 'Kongresni trg – Congress Square',
        year: 1821,
        lat: 46.050393, lng: 14.503797,
        description: `Venue of the Congress of the Holy Alliance (1821) and many pivotal political gatherings in 20th‑century Slovenia.`,
        link: 'https://sl.wikipedia.org/wiki/Kongresni_trg'
      },
      {
        id: 'castle',
        title: 'Ljubljanski grad – Ljubljana Castle',
        year: 12,
        lat: 46.048942, lng: 14.508155,
        description: `Medieval castle overlooking the city; a strategic site throughout Ljubljana’s history with layers of architectural phases.`,
        link: 'https://sl.wikipedia.org/wiki/Ljubljanski_grad'
      },
      {
        id: 'nul',
        title: 'NUK – Narodna in univerzitetna knjižnica',
        year: 1941,
        lat: 46.047962, lng: 14.504986,
        description: `Jože Plečnik’s monumental library, a masterpiece of Slovene modern classicism and a cultural landmark.`,
        link: 'https://sl.wikipedia.org/wiki/Narodna_in_univerzitetna_knji%C5%BEnica'
      },
      {
        id: 'parliament-1991',
        title: 'Slovenski parlament – Razglasitev neodvisnosti (1991)',
        year: 1991,
        lat: 46.052378, lng: 14.501942,
        description: `On 25 June 1991, Slovenia declared independence here, marking a decisive moment in national history.`,
        link: 'https://sl.wikipedia.org/wiki/Osamosvojitev_Slovenije'
      }
    ];

    // 3) Marker creation
    const markers = [];
    const layer = L.layerGroup().addTo(map);

    function makePopupHTML(p) {
      const yr = (p.year ? `<div><strong>Year:</strong> ${p.year}</div>` : '');
      const link = p.link ? `<div style="margin-top:6px"><a href="${p.link}" target="_blank" rel="noopener">Learn more →</a></div>` : '';
      return `
        <article>
          <header><h2 style="font-size:16px;margin:0 0 4px">${p.title}</h2></header>
          ${yr}
          <div>${p.description || ''}</div>
          ${link}
        </article>
      `;
    }

    function addPlaces(data) {
      layer.clearLayers();
      markers.length = 0;
      data.forEach(p => {
        const m = L.marker([p.lat, p.lng], { title: p.title });
        m.bindPopup(makePopupHTML(p));
        m.addTo(layer);
        markers.push({ marker: m, data: p });
      });
      if (data.length) {
        const group = L.featureGroup(markers.map(m => m.marker));
        map.fitBounds(group.getBounds().pad(0.2));
      }
    }

    addPlaces(PLACES);

    // 4) Simple text search over title/description/year
    function normalize(s) { return (s || '').toString().toLowerCase(); }

    function search(query) {
      const q = normalize(query);
      if (!q) { addPlaces(PLACES); return; }
      const filtered = PLACES.filter(p => {
        return normalize(p.title).includes(q)
            || normalize(p.description).includes(q)
            || String(p.year).includes(q);
      });
      addPlaces(filtered);
      if (filtered.length === 1) {
        // Open popup if exactly one match
        const hit = markers[0];
        hit.marker.openPopup();
      }
    }

    document.getElementById('btn-search').addEventListener('click', () => {
      const q = document.getElementById('q').value.trim();
      search(q);
    });

    document.getElementById('btn-reset').addEventListener('click', () => {
      document.getElementById('q').value = '';
      addPlaces(PLACES);
    });

    document.getElementById('q').addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        search(e.target.value.trim());
      }
    });

    // 5) Helper: click map to copy coordinates (for adding new places)
    map.on('contextmenu', (e) => {
      const { lat, lng } = e.latlng;
      const text = `${lat.toFixed(6)}, ${lng.toFixed(6)}`;
      navigator.clipboard.writeText(text).then(() => {
        L.popup()
          .setLatLng(e.latlng)
          .setContent(`Copied coordinates: <b>${text}</b><br/><small>Paste into a new place in PLACES[]</small>`)
          .openOn(map);
      });
    });
  </script>
</body>
</html>

